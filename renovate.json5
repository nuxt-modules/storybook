{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:recommended',
    // Group all minor and patch updates together
    'group:allNonMajor',
    // Schedule updates to run every weekend
    'schedule:weekends',
    // Use "chore" type for all commit messages
    ':semanticCommitTypeAll(chore)',
    // Pin all dev dependencies following https://docs.renovatebot.com/dependency-pinning/
    ':pinDevDependencies',
    // Always widen peer dependency constraints: https://docs.renovatebot.com/presets-default/#widenpeerdependencies
    ':widenPeerDependencies',
    // Update lock files: https://docs.renovatebot.com/presets-default/#maintainlockfilesmonthly
    ':maintainLockFilesMonthly',
    // Automerge all updates once they pass tests: https://docs.renovatebot.com/presets-default/#automergeall
    ':automergeAll',
    // Pin Github Actions versions: https://docs.renovatebot.com/presets-helpers/#helperspingithubactiondigeststosemver
    'helpers:pinGitHubActionDigestsToSemver',
  ],
  schedule: [
    // Monthly, but give a 3-day window (due to throttling not all PRs may be created on the same day): https://docs.renovatebot.com/configuration-options/#schedule
    'on the 2nd through 5th day of the month',
  ],
  // Always squash PRs: https://docs.renovatebot.com/configuration-options/#automergestrategy
  automergeStrategy: 'squash',
  // Don't ignore 'examples' directories
  ignorePaths: ['**/node_modules/**'],
  packageRules: [
    {
      // Pin all @storybook/* packages because even minor updates can break things for us, but use different strategy for peer deps
      matchPackagePatterns: ['storybook', '@storybook/*'],
      matchDepTypes: ['dependencies', 'devDependencies'],
      groupName: 'storybook packages',
      groupSlug: 'storybook',
      rangeStrategy: 'pin',
    },
    {
      // Use bump strategy for peer dependencies to maintain compatibility and desired version ranges
      matchPackagePatterns: ['storybook', '@storybook/*'],
      matchDepTypes: ['peerDependencies'],
      rangeStrategy: 'bump',
    },
    {
      // Pin all dependencies (for docs and examples) following https://docs.renovatebot.com/dependency-pinning/
      matchFileNames: ['docs/package.json', 'examples/**/package.json'],
      rangeStrategy: 'pin',
    },
  ],
  postUpdateOptions: [
    // Run pnpm dedupe after pnpm-lock.yaml updates
    'pnpmDedupe',
  ],
  customManagers: [
    {
      customType: 'regex',
      managerFilePatterns: [
        'docs/content/1.getting-started/1.setup.md',
        'docs/content/index.md',
      ],
      matchStrings: ['storybook@(?<currentValue>.*?) init'],
      depNameTemplate: 'storybook',
      datasourceTemplate: 'npm',
      depTypeTemplate: 'dependencies',
    },
    // Update `xyz_version` in github actions workflows:
    // Same as the https://docs.renovatebot.com/presets-customManagers/#custommanagersgithubactionsversions
    // but specifying a depType
    {
      customType: 'regex',
      managerFilePatterns: [
        '/(^|/)(workflow-templates|\\.(?:github|gitea|forgejo)/(?:workflows|actions))/.+\\.ya?ml$/',
        '/(^|/)action\\.ya?ml$/',
      ],
      matchStrings: [
        '# renovate: datasource=(?<datasource>[a-zA-Z0-9-._]+?) depName=(?<depName>[^\\s]+?)(?: (?:lookupName|packageName)=(?<packageName>[^\\s]+?))?(?: versioning=(?<versioning>[^\\s]+?))?(?: extractVersion=(?<extractVersion>[^\\s]+?))?\\s+[A-Za-z0-9_]+?_VERSION\\s*:\\s*["\']?(?<currentValue>.+?)["\']?\\s',
      ],
      depTypeTemplate: 'dependencies',
    },
  ],
}
